<!-- Generated by SpecStory -->

# 專案執行步驟討論 (2025-04-15 23:21:00)

_**User**_

請依照prj_task_new中要求執行

---

_**Assistant**_

我會幫您建立一個基於Flask的智慧問答機器人，同時支援Web介面和CLI介面。讓我們一步一步來實現這個專案。

首先，我們需要建立專案的基本結構和必要的檔案。

1. 首先，我會建立一個 `requirements.txt` 文件來管理依賴：


---

```diff
- 
+ flask==3.0.2
+ google-generativeai==0.3.2
+ python-dotenv==1.0.1 
```

---

2. 接下來，我們建立 `vercel.json` 配置文件：



---

```diff
- 
+ {
+     "version": 2,
+     "builds": [
+         {
+             "src": "api/app.py",
+             "use": "@vercel/python"
+         }
+     ],
+     "routes": [
+         {
+             "src": "/(.*)",
+             "dest": "api/app.py"
+         }
+     ],
+     "env": {
+         "GEMINI_API_KEY": "AIzaSyCWTS7qIG7X4xnnHzPpYyu5Tu3Q0489VzY",
+         "GEMINI_MODEL": "gemini-1.5-flash"
+     }
+ } 
```

---

3. 現在，讓我們創建主要的應用程式文件。首先建立 `api` 目錄：



---

```bash
mkdir api
```

```
PS F:\下載\cursor> mkdir api


    目錄: F:\下載\cursor


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----       2025/4/15  下午 11:22                api


PS F:\下載\cursor> mkdir api


    目錄: F:\下載\cursor


Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
d-----       2025/4/15  下午 11:22                api


PS F:\下載\cursor>







PS F:\下載\cursor>
```

---

4. 接下來，我們創建主要的應用程式文件 `api/app.py`：




---

```diff
- 
+ import os
+ import google.generativeai as genai
+ from flask import Flask, request, jsonify, render_template_string
+ import json
+ 
+ app = Flask(__name__)
+ 
+ # 從環境變數獲取API金鑰和模型名稱
+ GEMINI_API_KEY = os.getenv("GEMINI_API_KEY")
+ GEMINI_MODEL = os.getenv("GEMINI_MODEL", "gemini-1.5-flash")
+ 
+ # 配置Gemini
+ genai.configure(api_key=GEMINI_API_KEY)
+ model = genai.GenerativeModel(GEMINI_MODEL)
+ 
+ # HTML模板
+ HTML_TEMPLATE = """
+ <!DOCTYPE html>
+ <html>
+ <head>
+     <title>AI 聊天機器人</title>
+     <style>
+         body {
+             font-family: Arial, sans-serif;
+             max-width: 800px;
+             margin: 0 auto;
+             padding: 20px;
+             background-color: #f5f5f5;
+         }
+         #chat-container {
+             height: 400px;
+             overflow-y: auto;
+             border: 1px solid #ccc;
+             padding: 10px;
+             margin-bottom: 10px;
+             background-color: white;
+         }
+         .message {
+             margin-bottom: 10px;
+             padding: 10px;
+             border-radius: 5px;
+         }
+         .user-message {
+             background-color: #e3f2fd;
+             margin-left: 20%;
+         }
+         .bot-message {
+             background-color: #f5f5f5;
+             margin-right: 20%;
+         }
+         #input-container {
+             display: flex;
+             gap: 10px;
+         }
+         #user-input {
+             flex-grow: 1;
+             padding: 10px;
+         }
+         button {
+             padding: 10px 20px;
+             background-color: #2196f3;
+             color: white;
+             border: none;
+             border-radius: 5px;
+             cursor: pointer;
+         }
+         button:hover {
+             background-color: #1976d2;
+         }
+     </style>
+ </head>
+ <body>
+     <h1>AI 聊天機器人</h1>
+     <div id="chat-container"></div>
+     <div id="input-container">
+         <input type="text" id="user-input" placeholder="輸入您的問題...">
+         <button onclick="sendMessage()">發送</button>
+     </div>
+ 
+     <script>
+         function addMessage(message, isUser) {
+             const container = document.getElementById('chat-container');
+             const messageDiv = document.createElement('div');
+             messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
+             messageDiv.textContent = message;
+             container.appendChild(messageDiv);
+             container.scrollTop = container.scrollHeight;
+         }
+ 
+         async function sendMessage() {
+             const input = document.getElementById('user-input');
+             const message = input.value.trim();
+             if (!message) return;
+ 
+             addMessage(message, true);
+             input.value = '';
+ 
+             try {
+                 const response = await fetch('/chat', {
+                     method: 'POST',
+                     headers: {
+                         'Content-Type': 'application/json',
+                     },
+                     body: JSON.stringify({ message: message }),
+                 });
+                 const data = await response.json();
+                 addMessage(data.response, false);
+             } catch (error) {
+                 addMessage('抱歉，發生錯誤。請稍後再試。', false);
+             }
+         }
+ 
+         document.getElementById('user-input').addEventListener('keypress', function(e) {
+             if (e.key === 'Enter') {
+                 sendMessage();
+             }
+         });
+     </script>
+ </body>
+ </html>
+ """
+ 
+ @app.route('/')
+ def home():
+     return render_template_string(HTML_TEMPLATE)
+ 
+ @app.route('/chat', methods=['POST'])
+ def chat():
+     data = request.json
+     user_message = data.get('message', '')
+     
+     try:
+         response = model.generate_content(user_message)
+         return jsonify({'response': response.text})
+     except Exception as e:
+         return jsonify({'response': f'發生錯誤：{str(e)}'}), 500
+ 
+ def cli_mode():
+     print("歡迎使用AI聊天機器人 (CLI模式)")
+     print("輸入 'quit' 或 'exit' 結束對話")
+     
+     while True:
+         user_input = input("\n您: ").strip()
+         if user_input.lower() in ['quit', 'exit']:
+             print("再見！")
+             break
+             
+         try:
+             response = model.generate_content(user_input)
+             print(f"\nAI: {response.text}")
+         except Exception as e:
+             print(f"\n錯誤：{str(e)}")
+ 
+ if __name__ == '__main__':
+     import sys
+     if len(sys.argv) > 1 and sys.argv[1] == '--cli':
+         cli_mode()
+     else:
+         app.run(debug=True) 
```

---

5. 最後，讓我們創建一個 README.md 文件來說明如何使用這個應用程式：





---

```diff
- 
+ # AI 聊天機器人
+ 
+ 這是一個基於 Flask 和 Google Gemini AI 的聊天機器人應用程式，提供 Web 介面和 CLI 介面兩種使用方式。
+ 
+ ## 功能特點
+ 
+ - Web 介面：提供友好的網頁聊天介面
+ - CLI 介面：提供命令列介面進行測試
+ - 使用 Google Gemini AI 模型
+ - 支援 Vercel 部署
+ 
+ ## 安裝需求
+ 
+ - Python 3.7+
+ - Flask
+ - google-generativeai
+ - python-dotenv
+ 
+ ## 安裝步驟
+ 
+ 1. 安裝依賴套件：
+ ```bash
+ pip install -r requirements.txt
+ ```
+ 
+ ## 使用方式
+ 
+ ### Web 介面
+ 
+ 1. 執行以下命令啟動 Web 服務：
+ ```bash
+ python api/app.py
+ ```
+ 
+ 2. 開啟瀏覽器訪問 `http://localhost:5000`
+ 
+ ### CLI 介面
+ 
+ 執行以下命令啟動 CLI 模式：
+ ```bash
+ python api/app.py --cli
+ ```
+ 
+ ## 部署到 Vercel
+ 
+ 1. 確保已安裝 Vercel CLI
+ 2. 在專案根目錄執行：
+ ```bash
+ vercel
+ ```
+ 
+ ## 環境變數
+ 
+ 應用程式使用以下環境變數：
+ 
+ - `GEMINI_API_KEY`：Google Gemini API 金鑰
+ - `GEMINI_MODEL`：使用的 Gemini 模型名稱（預設：gemini-1.5-flash）
+ 
+ 這些變數可以在 `vercel.json` 中設定。 
```

---

我已經完成了所有必要的檔案設置。這個應用程式包含以下功能：

1. Web 介面：
   - 美觀的聊天介面
   - 即時對話功能
   - 響應式設計

2. CLI 介面：
   - 簡單的命令列介面
   - 方便測試和除錯

3. 整合 Gemini AI：
   - 使用 SDK 方式呼叫 AI 模型
   - 錯誤處理機制

4. Vercel 部署支援：
   - 完整的 `vercel.json` 配置
   - 環境變數設定

要開始使用這個應用程式，您需要：

1. 安裝依賴套件：
```bash
pip install -r requirements.txt
```

2. 選擇使用方式：
   - Web 介面：執行 `python api/app.py`
   - CLI 介面：執行 `python api/app.py --cli`

3. 如果要部署到 Vercel，只需要執行 `vercel` 命令即可。

您需要其他協助或有任何問題嗎？

---



---

